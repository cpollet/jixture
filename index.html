<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>jixture - an open source spring/hibernate based java fixtures loading framework</title>

		<meta name="description" content="Jixture is an open source spring/hibernate based java fixtures loading framework">
		<meta name="author" content="Christophe Pollet">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="reveal.js-2.6.2/css/reveal.min.css">
		<link rel="stylesheet" href="reveal.js-2.6.2/css/theme/night.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="reveal.js-2.6.2/lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="reveal.js-2.6.2/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>jixture</h1>
					<h3>Easy fixture loading in Java</h3>
					<p>
						<small>Created by Christophe Pollet</small>
					</p>
				</section>

				<section>
					<h2>“fixture”?</h2>
					<blockquote cite="http://en.wikipedia.org/wiki/Test_fixture">
						A test fixture is something used to consistently test some item, device, or piece of software.
					</blockquote>
					<p>
						For instance by loading a database with a predefined set of data.
					</p>
				</section>
				<section>
					<h2>Why jixture?</h2>
					<p>
						To provide easy database fixture loading in a Spring/Hibernate environment.
					</p>
				</section>
				<section>
					<h2>How easy?</h2>
					<ul>
						<li>Supports <a href="#/support-transactions">database transactions</a> out of the box</li>
						<li>Basic (but sufficient) support for foreign-key constraints</li>
						<li>Supports several fixture sources for a given test</li>
						<li>Can handle various <a href="#/formats">source formats</a></li>
						<li>Support <a href="#/support-extraction">extraction</a> of loaded fixtures</li>
					</ul>
				</section>
				<section>
					<h2>Which formats?</h2>
					<p>The following fixture formats are implemented:</p>
					<ul>
						<li>Java code</li>
						<li>XML files (DBUnit compatible)</li>
						<li>Excel sheets</li>
						<li>SQL scripts</li>
						<li>Spring beans</li>
						<li>Generated by code</li>
					</ul>
					<p>And it's easy to implement your own if needed!</p>
				</section>
				<section>
					<h1>Ready for some action?</h1>
				</section>

				<section>
					<h2>We need some dependency</h2>
					<pre><code class="xml" data-trim>
&lt;dependency&gt;
  &lt;groupId&gt;net.cpollet.jixture&lt;/groupId&gt;
  &lt;artifactId&gt;jixture-hibernate3&lt;/artifactId&gt;
  &lt;version&gt;1.0.0.rc3&lt;/version&gt;
&lt;/dependency&gt;
					</code></pre>
				</section>
				<section>
					<h2>And some Spring wiring</h2>
					<pre><code class="xml" data-trim>
&lt;!-- you have to define a transactionManager bean somewhere --&gt;
&lt;alias name="transactionManager" alias="jixture.core.transactionManager"/&gt;

&lt;!-- bring the magic --&gt;
&lt;import resource="classpath:/spring/jixture-core-context.xml"/&gt;
					</code></pre>
				</section>

				<section>
					<h1>And now…</h1>
				</section>
				<section>
					<h1>Let's write some tests</h1>
				</section>

				<section>
					<h2>Test skeleton</h2>
					<pre>
						<code class="java" data-trim>
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = {"classpath:/spring/test-context.xml"})
@DirtiesContext(classMode = DirtiesContext.ClassMode.AFTER_EACH_TEST_METHOD)
@Transactional
public class TestSomeClass {
}
						</code>
					</pre>
				</section>
				<section>
					<h2>Getting jixture to the mix</h2>
					<ul>
						<li>We want to load some fixture</li>
						<li>Without committing data</li>
					</ul>
					<pre>
						<code class="java" data-trim>
@Autowired
@Qualifier("jixture.noCommitDatabaseTestSupport")
private DatabaseTestSupport databaseTestSupport;
						</code>
					</pre>
				</section>
				<section id="format-java">
					<h2>Loading a fixture into database</h2>
					<pre>
						<code class="java" data-trim>
@Before
public void setUp() {
  Data data = new Data();
  data.setId(1L);
  data.setValue("value");

  databaseTestSupport.addFixtures(new MappingFixture(data)).loadFixtures();
}
						</code>
					</pre>
				</section>
				<section>
					<h1>And you're all set!</h1>
				</section>
				<section>
					<h1>But what if…</h1>
				</section>
				<section>
					<h1>… I have a DBUnit file?</h1>
				</section>
				<section>
					<h1>Pas de souci ™</h1>
				</section>

				<section id="format-xml">
					<h2>Just use the XML file fixture</h2>
					<pre>
						<code class="java" data-trim>
@Before
public void setUp() {
  databaseTestSupport.addFixtures(new XmlFileFixture("dbunit-data.xml")).loadFixtures();
}
						</code>
					</pre>
					<p>And that's it</p>
				</section>

				<section>
					<h1>Ok but now I need the data to be committed</h1>
				</section>
				<section id="support-transactions">
					<h2>Easy!</h2>
					<p>Bring <code>jixture.commitDatabaseTestSupport</code>:</p>
					<pre>
						<code class="java" data-trim>
@Autowired
@Qualifier("jixture.commitDatabaseTestSupport")
private DatabaseTestSupport commitDatabaseTestSupport;

@Autowired
@Qualifier("jixture.noCommitDatabaseTestSupport")
private DatabaseTestSupport noCommitDatabaseTestSupport;
						</code>
					</pre>
					<p>Et voilà</p>
				</section>

				<section>
					<h1>What about format XYZ you mentioned in the beginning?</h1>
				</section>
				<section id="formats">
					<h2>Let's have a look</h2>
					<ul>
						<li><a href="#/format-java">Java code</a></li>
						<li><a href="#/format-xml">XML files</a></li>
						<li><a href="#/format-excel">Excel sheets</a></li>
						<li><a href="#/format-sql">SQL scripts</a></li>
						<li><a href="#/format-spring">Spring beans</a></li>
						<li><a href="#/format-generated">Generated by code</a></li>
						<li><a href="#/format-cleaning">Cleaning fixture</a></li>
					</ul>
				</section>

				<section id="format-excel">
					<section>
						<h1>Excel sheets</h1>
					</section>
					<section>
						<h2>Dependencies</h2>
						<pre>
							<code class="xml" data-trim>
&lt;!-- For XLSX --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
  &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;
  &lt;version&gt;3.9&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For XLS --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
  &lt;artifactId&gt;poi&lt;/artifactId&gt;
  &lt;version&gt;3.9&lt;/version&gt;
&lt;/dependency&gt;
							</code>
						</pre>
					</section>
					<section>
						<h2>Load fixture with</h2>
						<pre>
							<code class="java" data-trim>
@Before
public void setUp() {
  databaseTestSupport
    .addFixtures(new XlsFileFixture("fixtures.xls"))   // loads XLS file
    .addFixtures(new XlsxFileFixture("fixtures.xlsx")) // loads XLSX file
    .loadFixtures();
}
							</code>
						</pre>
					</section>
					<section>
						<h2>Excel file format</h2>
						<ul>
							<li>One table per sheet</li>
							<li>Sheet name corresponds to table name</li>
							<li>Sheets having name beginning with “!” are ignored</li>
							<li>First row value gives table's column name</li>
							<li>Column name “!mode” is special</li>
							<li>Possibility to use excel formulas</li>
						</ul>
					</section>
					<section>
						<h2>Column "!mode"?</h2>
						<ul>
							<li>tags the row as input or output row</li>
							<li>if “in” or “all” the data will be inserted in database</li>
							<li>with “out” or “all” the data will not be inserted but can be used in assertions</li>
						</ul>
					</section>
					<section>
						<h2>Example</h2>
						<p>
							<img src="images/excel.png">
						</p>
					</section>

				</section>

				<section id="format-sql">
					<section>
						<h1>SQL scripts</h1>
					</section>
					<section>
						<h2>Load fixture with</h2>
						<p>Inline script</p>
						<pre>
							<code class="java" data-trim>
@Before
public void setUp() {
databaseTestSupport
  .addFixtures(new SqlFixture(new String[] {
    "insert into users ...", "insert into products ..."
  }, User.class, Product.class))
  .loadFixtures();
}
							</code>
						</pre>
					</section>
					<section>
					<h2>Load fixture with</h2>
					<p>External script</p>
						<pre>
							<code class="java" data-trim>
@Before
public void setUp() {
  databaseTestSupport
    .addFixtures(new SqlFileFixture("classpath:tests/fixtures/sql-fixture.sql",
      User.class, Product.class))
  .loadFixtures();
}
							</code>
						</pre>
					</section>
				</section>
				<section id="format-spring">
					<section>
						<h1>Spring beans</h1>
					</section>
					<section>
						<h2>Load fixture with</h2>
						<pre>
							<code class="java" data-trim>
@Before
public void setUp() {
  databaseTestSupport
    .addFixtures(new SpringFixture("classpath:tests/fixtures/spring-fixture.xml",
      User.class, Product.class))
    .loadFixtures();
}
							</code>
						</pre>
					</section>
				</section>
				<section id="format-generated">
					<section>
						<h1>Generated by code</h1>
					</section>
					<section>
						<h2>The most complex fixture source…</h2>
					</section>
					<section>
						<h2>…but the most powerful</h2>
					</section>
					<section>
						<h2>Concepts</h2>
						<ul>
							<li>generate mappings using Java code</li>
							<li>use mapping template</li>
							<li>use generators to generate attributes values</li>
						</ul>
					</section>
					<section>
						<h2>When to use?</h2>
						<p>
							When you want to generate many different mapping that kind of look the same. For instance,
							orders that can be in one of the following statuses:
						</p>
						<ul>
							<li>new</li>
							<li>validated</li>
							<li>in preparation</li>
							<li>prepared</li>
							<li>shipping</li>
							<li>shipped</li>
						</ul>
					</section>
					<section>
						<h2>When to use</h2>
						<p>And submitted from different countries:</p>
						<ul>
							<li>Switzerland</li>
							<li>France</li>
							<li>USA</li>
						</ul>
					</section>
					<section>
						<h2>Dependencies</h2>
						<pre>
							<code class="xml" data-trim>
&lt;dependency&gt;
  &lt;groupId&gt;commons-beanutils&lt;/groupId&gt;
  &lt;artifactId&gt;commons-beanutils&lt;/artifactId&gt;
  &lt;version&gt;1.9.2&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;uk.com.robust-it&lt;/groupId&gt;
  &lt;artifactId&gt;cloning&lt;/artifactId&gt;
  &lt;version&gt;1.9.0&lt;/version&gt;
&lt;/dependency&gt;
							</code>
						</pre>
					</section>
					<section>
						<h2>Show me some code</h2>
						<pre>
							<code class="java" data-trim>
@Before
public void setUp() {
  Order order = new Order();
  order.setOrderDate(new Date());

  GeneratedFixture generatedFixture = new GeneratedFixture();

  generatedFixture
    .addGenerators(GeneratedFixture
      .from(order)
      .addFieldGenerator("id", FieldGenerators.sequence(1))
      .addFieldGenerator("status", FieldGenerators.in(
        Status.NEW, Status.VALIDATED, Status.IN_PREPARATION, ...
      )
      .addFieldGenerator("country", FieldGenerator.in("Switzerland", "France", "USA")
      .addFieldGenerator("totalPrice", FieldGenerators.sequence(1, 5, 2))
    );

  databaseTestSupport.addFixtures(generatedFixture).loadFixtures();
}
							</code>
						</pre>
					</section>
					<section>
						<h2>Field generators</h2>
						<p>jixture support several field value generators:</p>
						<ul>
							<li>DateSequence</li>
							<li>{Integer,Long}Sequence</li>
							<li>{Integer,Long,String}IndexSequence</li>
							<li>SimpleStringGenerator</li>
							<li>MultiFieldGenerator</li>
						</ul>
					</section>
				</section>
				<section id="format-cleaning">
					<section>
						<h1>Cleaning fixture</h1>
					</section>
					<section>
						<h2>When to use?</h2>
						<p>
							When all you want to do is to (partially) clean the database
						</p>
					</section>
					<section>
						<h2>Code</h2>
						<pre>
							<code>
@Before
public void setUp() {
  CleaningFixture fixture = new CleaningFixture(Product.class, Client.class, Order.class);
  databaseTestSupport.addFixtures(fixture).loadFixtures();
}
							</code>
						</pre>
					</section>
				</section>
				<section id="support-extraction">
					<h1>You mentioned “extraction of loaded fixtures”</h1>
					<p>What is this???</p>
				</section>
				<section>
					<h2>Well…</h2>
					<p>When loading fixture it may be convinient to get a subset of the inserted data</p>
					<p>This is what an extractor does</p>
				</section>
				<section>
					<h2>Scope</h2>
					<p>Not all fixture sources can be used together with extraction.</p>
					<p>The following can:</p>
					<ul>
						<li><a href="#/format-java">Java code</a></li>
						<li><a href="#/format-xml">XML files</a></li>
						<li><a href="#/format-excel">Excel sheets</a></li>
						<li><a href="#/format-spring">Spring beans</a></li>
						<li><a href="#/format-generated">Generated by code</a></li>
						<li><a href="#/format-cleaning">Cleaning fixture</a></li>
					</ul>
					<p>To make a long story short, all <code>Fixture</code> that implement <code>ExtractionCapableFixture</code></p>
				</section>
				<section>
					<h2>Needed dependency</h2>
					<pre>
						<code class="xml" data-trim>
&lt;dependency&gt;
  &lt;groupId&gt;org.hamcrest&lt;/groupId&gt;
  &lt;artifactId&gt;hamcrest-core&lt;/artifactId&gt;
  &lt;version&gt;1.3&lt;/version&gt;
&lt;/dependency&gt;
						</code>
					</pre>
				</section>
				<section>
					<h2>Some code</h2>
					<pre>
						<code class="java" data-trim>
fixture.addExtractorMatcher(ExtractorMatcher.create(new org.hamcrest.core.IsAnything()));
// extracor matcher can have a name

ExtractionResult extractionResult = fixture.getExtractionResult();

List entities = extractionResult.getEntities();
// or
// extractionResult.getEntities(Model.class);
// extractionResult.getEntities("extractor name");
// extractionResult.getEntities("extractor name", Model.class);
						</code>
					</pre>
				</section>

				<section>
					<h2>Resources</h2>
					<ul>
						<li><a href="https://github.com/cpollet/jixture">github</a></li>
						<li><a href="http://jixture.cpollet.net/jixture-core/apidocs/index.html">core javadoc</a></li>
					</ul>
				</section>

				<section>
					<h1>Questions?</h1>
				</section>
			</div>
		</div>

		<script src="reveal.js-2.6.2/lib/js/head.min.js"></script>
		<script src="reveal.js-2.6.2/js/reveal.min.js"></script>

		<script>
			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				slideNumber: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'reveal.js-2.6.2/lib/js/classList.js', condition: function() { return !document.body.classList; } },
//					{ src: 'reveal.js-2.6.2/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
//					{ src: 'reveal.js-2.6.2/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js-2.6.2/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'reveal.js-2.6.2/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
//					{ src: 'reveal.js-2.6.2/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
